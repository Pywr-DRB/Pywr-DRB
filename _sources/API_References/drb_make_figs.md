# `drb_make_figs.py`

This module retrieves the Pywr-DRB model output, and produces all of the [Figures](../Getting_Started/Interpret_Results/output_figures.md) for each simulation result.

All figures (for different models and nodes) are produced and saved in `DRB_water_management/figs/` when `drb_make_figs.py` is executed.

**Functions:**
- `get_pywr_results()`
This function retrieves the `drb_output_<inflow_type>.hdf5` output file and returns a Pandas DataFrame of simulated timeseries values.

- `get_base_results()`
A function for retrieving & organizing results from non-pywr results (NHM, NWM, WEAP).

- `get_error_metrics()`
Compiles error metrics across models and nodes.

- `get_RRV_metrics()`
Get measures of reliability, resilience, and vulnerability from Hashimoto et al., 1982.


*The following plotting functions are included in `drb_make_figs.py`, but are documented in the [Plotting Functions](./plotting_functions.md) reference:*
- `plot_3part_flows()`
- `plot_weekly_flow_distributions()`
- `plot_radial_error_metrics()`
- `plot_rrv_metrics()`
- `plot_flow_contributions()`


***
### `get_pywr_results()`
This function retrieves the `drb_output_<inflow_type>.hdf5` output file and returns a Pandas DataFrame of simulated timeseries values. The resulting DataFrame contains columns with the different timeseries values (column names corresponding to nodes) and a datetime index.

#### Syntax
```python
get_pywr_results(output_dir: str, model: str, results_set: str) -> DataFrame
```

**Parameters:**
- `output_dir` (str): The relative path to the output data folder.
- `model` (str): The indicator name for the dataset of interest. See the [Data Summary](../Supplemental/data_summary.md) page for more info.
- `results_set` (str): Specify which types of model nodes to retrieve from the output file. Options are 'all', 'res_releases', or 'major_flow'. Default is 'all'.

**Returns:**
- `results` (pd.DataFrame): A DataFrame with the results of interest, index is datetime.


***
### `get_base_results()`
This is a function for retrieving & organizing results from non-pywr results (NHM, NWM, WEAP). It retrieves `gage_flow_<model>.csv` from the input directory, and returns a DataFrame which matches the formatting of the data produced by `get_pywr_results()`.

#### Syntax
```python
get_base_results(input_dir: str, model: str, datetime_index: datetime, results_set: str) -> DataFrame
```

**Parameters:**
- `input_dir` (str): The relative path to the input data directory.
- `model` (str): The indicator name for the dataset of interest. See the [Data Summary](../Supplemental/data_summary.md) page for more info.
-  `datetime_index` (datetime): A pd.datetime type index. Use the index from the results generated by `get_pywr_results()` to align data.
- `results_set` (str): Specify which types of model nodes to retrieve from the output file. Options are 'all', 'res_releases', or 'major_flow'.

**Returns:**
- `gage_flow` (DataFrame): A DataFrame containing a subset of the `gage_flow` data, index is datetime.


***
### `get_error_metrics()`
Compiles error metrics across models and nodes. Metrics include NSE, KGE and KGE components (relative bias, variance and correlation), log-transformations of all of these metrics, and the Kolmogorov-Smirnov Statistic.

#### Syntax
```python
get_error_metrics(results: pd.DataFrame, models: list, nodes: list) -> pd.DataFrame
```

**Parameters:**
- `results` (pd.DataFrame): The df containing results, generated by `get_pywr_results()` or `get_base_results()`.
- `models` (list): The list of string indicator names for the datasets/models of interest.
- `nodes` (list): The list of strings of the nodes of interest.

**Returns:**
- `results_metrics` (pd.DataFrame): A DataFrame of DataFrames containing all metrics across all models and nodes.


***
### `get_RRV_metrics()`
Get measures of reliability, resilience, and vulnerability (Hashimoto et al., 1982) based on the Montague and Trenton flow targets.

#### Syntax
```python
get_RRV_metrics(results: pd.DataFrame, models: list, nodes: list) -> pd.DataFrame
```

**Parameters:**
- `results` (pd.DataFrame): The df containing results, generated by `get_pywr_results()` or `get_base_results()`.
- `models` (list): The list of string indicator names for the datasets/models of interest.
- `nodes` (list): The list of strings of the nodes of interest.

**Returns:**
- `rrv_metrics` (pd.DataFrame): A DataFrame of DataFrames containing RRV metrics across all models and nodes.
