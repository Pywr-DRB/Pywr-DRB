
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pywr-DRB Tutorial 3: Model Parameters &#8212; Pywr-DRB Integrated Water Resource Management Model</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/Tutorial 03 Model Parameters';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Overview:" href="Tutorial%2001%20Introduction%20to%20PywrDRB.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Pywr-DRB Integrated Water Resource Management Model - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="Pywr-DRB Integrated Water Resource Management Model - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Pywr-DRB
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../api/api.html">API References</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/pre.html">Pre-Processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.disaggregate_DRBC_demands.html">pywrdrb.pre.disaggregate_DRBC_demands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.extrapolate_NYC_NJ_diversions.html">pywrdrb.pre.extrapolate_NYC_NJ_diversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.predict_inflows_diversions.html">pywrdrb.pre.predict_inflows_diversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.predict_ensemble_inflows_diversions.html">pywrdrb.pre.predict_ensemble_inflows_diversions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.read_modeled_estimates.html">pywrdrb.pre.read_modeled_estimates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.read_csv_data.html">pywrdrb.pre.read_csv_data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.match_gages.html">pywrdrb.pre.match_gages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.create_hybrid_modeled_observed_datasets.html">pywrdrb.pre.create_hybrid_modeled_observed_datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.subtract_upstream_catchment_inflows.html">pywrdrb.pre.subtract_upstream_catchment_inflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.pre.add_upstream_catchment_inflows.html">pywrdrb.pre.add_upstream_catchment_inflows</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/post.html">Post-Processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.post.get_base_results.html">pywrdrb.post.get_base_results</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.post.get_pywrdrb_results.html">pywrdrb.post.get_pywrdrb_results</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/parameters.html">Parameters</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.FfmpNycRunningAvgParameter.html">pywrdrb.parameters.FfmpNycRunningAvgParameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.FfmpNjRunningAvgParameter.html">pywrdrb.parameters.FfmpNjRunningAvgParameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.NYCCombinedReleaseFactor.html">pywrdrb.parameters.NYCCombinedReleaseFactor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.NYCFloodRelease.html">pywrdrb.parameters.NYCFloodRelease</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.TotalReleaseNeededForDownstreamMRF.html">pywrdrb.parameters.TotalReleaseNeededForDownstreamMRF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.VolBalanceNYCDownstreamMRF_step1.html">pywrdrb.parameters.VolBalanceNYCDownstreamMRF_step1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.VolBalanceNYCDownstreamMRF_step2.html">pywrdrb.parameters.VolBalanceNYCDownstreamMRF_step2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.VolBalanceNYCDemand.html">pywrdrb.parameters.VolBalanceNYCDemand</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.LowerBasinMaxMRFContribution.html">pywrdrb.parameters.LowerBasinMaxMRFContribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.VolBalanceLowerBasinMRFAggregate.html">pywrdrb.parameters.VolBalanceLowerBasinMRFAggregate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.VolBalanceLowerBasinMRFIndividual.html">pywrdrb.parameters.VolBalanceLowerBasinMRFIndividual</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.STARFITReservoirRelease.html">pywrdrb.parameters.STARFITReservoirRelease</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.FlowEnsemble.html">pywrdrb.parameters.FlowEnsemble</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.PredictionEnsemble.html">pywrdrb.parameters.PredictionEnsemble</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.parameters.LaggedReservoirRelease.html">pywrdrb.parameters.LaggedReservoirRelease</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api/utils.html">Utilities</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.utils.hdf5.get_hdf5_realization_numbers.html">pywrdrb.utils.hdf5.get_hdf5_realization_numbers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.utils.hdf5.extract_realization_from_hdf5.html">pywrdrb.utils.hdf5.extract_realization_from_hdf5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.utils.hdf5.combine_batched_hdf5_outputs.html">pywrdrb.utils.hdf5.combine_batched_hdf5_outputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.utils.timeseries.subset_timeseries.html">pywrdrb.utils.timeseries.subset_timeseries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/generated/pywrdrb.utils.timeseries.get_rollmean_timeseries.html">pywrdrb.utils.timeseries.get_rollmean_timeseries</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../api/plotting.html">Plotting</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="examples.html">Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Tutorial%2001%20Introduction%20to%20PywrDRB.html">Overview:</a></li>






<li class="toctree-l2 current active"><a class="current reference internal" href="#">Model Parameters</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Pywr-DRB/Pywr-DRB" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Pywr-DRB/Pywr-DRB/issues/new?title=Issue%20on%20page%20%2Fexamples/Tutorial 03 Model Parameters.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/examples/Tutorial 03 Model Parameters.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Pywr-DRB Tutorial 3: Model Parameters</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#links">Links:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content">Content:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pywr-parameters">1.0 Pywr parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-parameters">1.1. The role of parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-parameters">1.2 Basic parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#constantparameter">ConstantParameter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregatedparameter">AggregatedParameter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframeparameter">DataFrameParameter</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-parameters">1.3 Custom parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pywr-drb-parameters">2.0 Pywr-DRB parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-tangent-pywrdrb-make-model">2.1 A quick tangent: <code class="docutils literal notranslate"><span class="pre">pywrdrb.make_model()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-parameters-in-pywr-drb">2.2 Basic parameters in Pywr-DRB</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-parameters-in-pywr-drb">2.3 Custom parameters in Pywr-DRB</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#starfitreservoirrelease">2.3.1 <code class="docutils literal notranslate"><span class="pre">STARFITReservoirRelease</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ffmp-and-lower-basin-ffmp-parameters">2.3.2 FFMP and lower basin FFMP parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#activity-explore-the-parameters-in-pywr-drb">Activity: Explore the parameters in Pywr-DRB</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pywr-drb-tutorial-3-model-parameters">
<h1>Pywr-DRB Tutorial 3: Model Parameters<a class="headerlink" href="#pywr-drb-tutorial-3-model-parameters" title="Link to this heading">#</a></h1>
<section id="links">
<h2>Links:<a class="headerlink" href="#links" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>This notebook draws heavily from the <a class="reference external" href="https://pywr.github.io/pywr/extending_pywr/extending_pywr_parameters.html"><code class="docutils literal notranslate"><span class="pre">pywr</span></code> documentation for creating custom parameters.</a> I’d recommend reading that for more detail.</p></li>
<li><p><a class="reference external" href="https://pywr.github.io/pywr/api/pywr.parameters.html">Pywr parameters API docs</a></p></li>
</ul>
</section>
<section id="content">
<h2>Content:<a class="headerlink" href="#content" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Pywr parameters</p>
<ul>
<li><p>The role of parameters</p></li>
<li><p>Basic parameters</p></li>
<li><p>Custom parameters</p></li>
</ul>
</li>
<li><p>Pywr-DRB parameters</p>
<ul>
<li><p>A quick tangent: <code class="docutils literal notranslate"><span class="pre">pywrdrb.make_model()</span></code></p></li>
<li><p>Basic parameters in Pywr-DRB</p></li>
<li><p>Custom parameters in Pywr-DRB</p></li>
</ul>
</li>
<li><p>Activity: Create a custom parameter</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="pywr-parameters">
<h2>1.0 Pywr parameters<a class="headerlink" href="#pywr-parameters" title="Link to this heading">#</a></h2>
<p>The term “parameter” is used to describe many different things in different modeling contexts.  In the context of <code class="docutils literal notranslate"><span class="pre">pywr</span></code>, Parameters are one of the three major objects used to define a model:</p>
<ul class="simple">
<li><p>Nodes</p></li>
<li><p>Edges</p></li>
<li><p>Parameters</p></li>
</ul>
<section id="the-role-of-parameters">
<h3>1.1. The role of parameters<a class="headerlink" href="#the-role-of-parameters" title="Link to this heading">#</a></h3>
<p>Parameters are a critical part of a pywr model.  Parameters are used to enforce the “rules” in the model.</p>
<p>In a linear programming problem, the goal is to find a vector <span class="math notranslate nohighlight">\(x\)</span> which maximizes the objective function such that the constraints are not violated:
$<span class="math notranslate nohighlight">\(\text{Maximize  }  c^Tx\)</span><span class="math notranslate nohighlight">\(
\)</span><span class="math notranslate nohighlight">\(\text{s.t.  } Ax \leq b \,\, \text{and} \,\, x \geq 0\)</span><span class="math notranslate nohighlight">\(
For a water resource model, like Pywr-DRB, the decision variable \)</span>x<span class="math notranslate nohighlight">\( corresponds to the reservoir release for a specific day.  In this context, the parameters are used to calculate, set, and update the *constraints* which consist of \)</span>A<span class="math notranslate nohighlight">\( and \)</span>b$ in this formulation. These constraints correspond to minimum and maximum release requirements.</p>
<p>As you will see, we connect specific parameters to different nodes or to other parameters. This is necessary when you have dependencies in the model.</p>
</section>
<section id="basic-parameters">
<h3>1.2 Basic parameters<a class="headerlink" href="#basic-parameters" title="Link to this heading">#</a></h3>
<p>Pywr allows for both premade and custom parameters to be used in a model. The “basic” parameters are helpful for a lot of the simple operations we want to implement, but we will discuss the importance of custom parameters below.</p>
<p>See the full list of pywr parameters <a class="reference external" href="https://pywr.github.io/pywr/api/pywr.parameters.html">HERE</a>.</p>
<p>Here, I highlight just a few basic parameters including:</p>
<ul class="simple">
<li><p>ConstantParameter</p></li>
<li><p>AggregatedParameter</p></li>
<li><p>DataFrameParameter</p></li>
</ul>
<section id="constantparameter">
<h4>ConstantParameter<a class="headerlink" href="#constantparameter" title="Link to this heading">#</a></h4>
<p>This is a simple parameter, which is used to provide a single constant value during each step.</p>
</section>
<section id="aggregatedparameter">
<h4>AggregatedParameter<a class="headerlink" href="#aggregatedparameter" title="Link to this heading">#</a></h4>
<p>From the <a class="reference external" href="https://pywr.github.io/pywr/api/generated/pywr.parameters.AggregatedParameter.html#pywr.parameters.AggregatedParameter">pywr.parameters.AggregatedParameter API:</a>
It’s value is the value of it’s child parameters aggregated using a aggregating function (e.g. sum).”</p>
<p>This class takes two inputs:</p>
<ul class="simple">
<li><p>parameters: The parameters to aggregate</p></li>
<li><p>agg_func: The aggregation function. Must be one of {“sum”, “min”, “max”, “mean”, “product”}, or a callable function which accepts a list of values.</p></li>
</ul>
</section>
<section id="dataframeparameter">
<h4>DataFrameParameter<a class="headerlink" href="#dataframeparameter" title="Link to this heading">#</a></h4>
<p>This is designed to let you access CSV data during the simulation using <code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code> style syntax.</p>
<p>This example from the documentation shows how it works.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;catchment_inflow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;dataframe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;data/catchmod_outputs_v2.csv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="s2">&quot;Flow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;index_col&quot;</span><span class="p">:</span> <span class="s2">&quot;Date&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parse_dates&quot;</span><span class="p">:</span> <span class="n">true</span>
    <span class="p">}</span>
<span class="p">]}</span>
</pre></div>
</div>
</section>
</section>
<section id="custom-parameters">
<h3>1.3 Custom parameters<a class="headerlink" href="#custom-parameters" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>“<em>Custom parameters can be used to model specific behaviors otherwise not possible with the existing parameters. To write a custom parameter you must (as a minimum) inherit from the base <code class="docutils literal notranslate"><span class="pre">pywr.parameter.Parameter</span></code> class and implement the <code class="docutils literal notranslate"><span class="pre">Parameter.value</span></code> method. The arguments to this method represent the current timestep and scenario allowing the value of the parameter to be dynamic.</em>”</p>
</div></blockquote>
<p>Each custom parameter should include the following methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Parameter.__init__()</span></code></p>
<ul>
<li><p>This will be run once when setting up the parameter</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Parameter.value()</span></code></p>
<ul>
<li><p>This is necessary, and will be called once per timestep.  The output of this method is the output of the parameter each timestep.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Parameter.load()</span></code></p>
<ul>
<li><p>This special <code class="docutils literal notranslate"><span class="pre">&#64;classmethod</span></code> is used to help create the parameter, and will establish connections between the parameter and each of the other nodes and parameters which influence the <code class="docutils literal notranslate"><span class="pre">value()</span></code>.</p></li>
</ul>
</li>
</ul>
<p>Here is an example provided in the Pwyr documentation, which just returns a constant value each timestep, and contains each of the methods described above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pywr.parameters</span> <span class="kn">import</span> <span class="n">Parameter</span>

<span class="k">class</span> <span class="nc">MyParameter</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># called once when the parameter is created</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">scenario_index</span><span class="p">):</span>
        <span class="c1"># called once per timestep for each scenario</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># called when the parameter is loaded from a JSON document</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>

<span class="n">MyParameter</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>  <span class="c1"># register the name so it can be loaded from JSON</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>The Parameter.value() function is the most important!  Pywr is going to ask for the value() during each timestep, and it must get something in response.</strong></p>
</div></blockquote>
</section>
</section>
<hr class="docutils" />
<section id="pywr-drb-parameters">
<h2>2.0 Pywr-DRB parameters<a class="headerlink" href="#pywr-drb-parameters" title="Link to this heading">#</a></h2>
<section id="a-quick-tangent-pywrdrb-make-model">
<h3>2.1 A quick tangent: <code class="docutils literal notranslate"><span class="pre">pywrdrb.make_model()</span></code><a class="headerlink" href="#a-quick-tangent-pywrdrb-make-model" title="Link to this heading">#</a></h3>
<p>Recall from Pywr-DRB Tutorial 1 that the file <code class="docutils literal notranslate"><span class="pre">drb_model_full_&lt;input</span> <span class="pre">type&gt;.json</span></code> contains all of the structural information defining the model.</p>
<p>Essentially, this is a dictionary containing lists of nodes, edges, and parameters. Together, this information is used by Pywr to construct the linear program which is used to simulate operations.</p>
<p>The structure of this file will look something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;timestepper&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;solver&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When working with Pywr-DRB, we use a specific function called <code class="docutils literal notranslate"><span class="pre">make_model()</span></code> to generate this JSON.</p>
<p>Future tutorials will focus on the details of the <code class="docutils literal notranslate"><span class="pre">make_model()</span></code> process, but it is important to point out in this tutorial since the parameters are used in this process.</p>
<p>For now, go and take a look in the file: <code class="docutils literal notranslate"><span class="pre">Pywr-DRB/pywrdrb/make_model.py</span></code>.</p>
<p>There are two main functions to point out:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add_major_node()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make_model()</span></code></p></li>
</ul>
</section>
<section id="basic-parameters-in-pywr-drb">
<h3>2.2 Basic parameters in Pywr-DRB<a class="headerlink" href="#basic-parameters-in-pywr-drb" title="Link to this heading">#</a></h3>
<p>We use the constant parameter to define the maximum reservoir volume constraint in <code class="docutils literal notranslate"><span class="pre">make_model.add_major_node()</span></code>, like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### max volume of reservoir, from GRanD database except where adjusted from other sources (eg NYC)</span>
<span class="k">if</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s1">&#39;reservoir&#39;</span><span class="p">:</span>
	<span class="n">model</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;max_volume_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span>
		<span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;drb_model_istarf_conus.csv&#39;</span><span class="p">,</span>
		<span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="s1">&#39;Adjusted_CAP_MG&#39;</span><span class="p">,</span>
		<span class="s1">&#39;index_col&#39;</span><span class="p">:</span> <span class="s1">&#39;reservoir&#39;</span><span class="p">,</span>
		<span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
	<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="custom-parameters-in-pywr-drb">
<h3>2.3 Custom parameters in Pywr-DRB<a class="headerlink" href="#custom-parameters-in-pywr-drb" title="Link to this heading">#</a></h3>
<p>Go look in the folder <code class="docutils literal notranslate"><span class="pre">Pywr-DRB/pywrdrb/parameters</span></code>…  This folder contains the scripts which define the custom parameters used in our model.</p>
<p>These include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">starfit.py</span></code></p>
<ul>
<li><p>This contains the <code class="docutils literal notranslate"><span class="pre">STARFITReservoirRelease</span></code> parameter which is used to determine the daily release volume at each of the STARFIT reservoirs.  This is discussed in more detail below.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ffmp.py</span></code></p>
<ul>
<li><p>This contains many different parameters which are used to determine NYC reservoir releases using the FFMP rules.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">lower_basin_ffmp.py</span></code></p>
<ul>
<li><p>This contains a few parameters which are used to determine when and how much the lower basin reservoirs should contribute to the Montague or Trenton flow targets.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">general.py</span></code></p>
<ul>
<li><p>This contains the <code class="docutils literal notranslate"><span class="pre">LaggedReservoirRelease</span></code> parameter. Pywr doesn’t have a parameter to return a previous (&gt;1 timesteps) node flow or parameter value. But we can calculate release for N timesteps ago based on rolling avg parameters for N &amp; (N-1) timesteps.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">inflow_ensemble.py</span></code></p>
<ul>
<li><p>When running multiple scenarios at once, we use a custom parameter called <code class="docutils literal notranslate"><span class="pre">FlowEnsemble</span></code> which provides access to inflow ensemble timeseries during the simulation period.</p></li>
</ul>
</li>
</ul>
<section id="starfitreservoirrelease">
<h4>2.3.1 <code class="docutils literal notranslate"><span class="pre">STARFITReservoirRelease</span></code><a class="headerlink" href="#starfitreservoirrelease" title="Link to this heading">#</a></h4>
<p>This custom parameter is used to calculate the target reservoir release for each day of the simulation, for non-NYC reservoirs.</p>
<p>If you are unfamiliar with the STARFIT reservoir operations functions, start by reviewing the following publication:</p>
<ul class="simple">
<li><p>Turner, Steyaert, Condon, Voisin (2021) <em>Water storage and release policies for all large reservoirs of conterminous United States</em>, <a class="reference external" href="https://doi.org/10.1016/j.jhydrol.2021.126843" title="Persistent link using digital object identifier">https://doi.org/10.1016/j.jhydrol.2021.126843</a></p></li>
</ul>
<p>For each reservoir, we have a set of values which define the functions used to calculate the target release.  There are multiple steps in the calculation.  This workflow is shown in Figure 6 from Turner et al. (2021):</p>
<p><img alt="Figure 6 from Turner et al. (2021)" src="https://ars.els-cdn.com/content/image/1-s2.0-S0022169421008933-gr1.jpg" /></p>
<p>As depicted in the figure, we need to perform several calculations to determine the target release including:</p>
<ul class="simple">
<li><p>Normal operating range (NOR) upper and lower bounds</p></li>
<li><p>Seasonal release harmonic</p></li>
<li><p>Release adjustment</p></li>
</ul>
<p>With this in mind, now look at the outline for the <code class="docutils literal notranslate"><span class="pre">STARFITReservoirRelease</span></code> below, and notice how this class has several internal functions design to help calculate the target release.</p>
<p>Again, the most important part of this is the output of the <code class="docutils literal notranslate"><span class="pre">STARFITReservoirRelease.value()</span></code> function. Pywr is not interested in the value of the <code class="docutils literal notranslate"><span class="pre">get_NORhi()</span></code> or any other supplemental functions. These are just necessary to help calculate the <code class="docutils literal notranslate"><span class="pre">value()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">STARFITReservoirRelease</span><span class="p">(</span><span class="n">Parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        model (dict): The PywrDRB model.</span>
<span class="sd">        storage_node (str): The storage node associated with the reservoir.</span>
<span class="sd">        flow_parameter: The PywrDRB catchment inflow parameter corresponding to the reservoir.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">storage_node</span><span class="p">,</span> <span class="n">flow_parameter</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># This is where we get all reservoir-specific parameters</span>
        <span class="c1"># from the drb_istarf_conus.csv data</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">standardize_inflow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inflow</span><span class="p">):</span>
	    <span class="k">return</span> <span class="p">(</span><span class="n">inflow</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">I_bar</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">I_bar</span>
	
    <span class="k">def</span> <span class="nf">calculate_percent_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">storage</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_cap</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">get_NORhi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>
		<span class="o">...</span>
		<span class="k">return</span> 

	<span class="k">def</span> <span class="nf">get_NORlo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>
		<span class="o">...</span>
		<span class="k">return</span>

    <span class="k">def</span> <span class="nf">get_harmonic_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">):</span>
	    <span class="o">...</span>
	    <span class="k">return</span>

    <span class="k">def</span> <span class="nf">calculate_release_adjustment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">S_hat</span><span class="p">,</span> <span class="n">I_hat</span><span class="p">,</span>
                                     <span class="n">NORhi_t</span><span class="p">,</span> <span class="n">NORlo_t</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">calculate_target_release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">harmonic_release</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span>
                                 <span class="n">NORhi</span><span class="p">,</span> <span class="n">NORlo</span><span class="p">,</span> <span class="n">S_hat</span><span class="p">,</span> <span class="n">I</span><span class="p">):</span>
		<span class="o">...</span>
		<span class="k">return</span> <span class="n">target</span>

    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestep</span><span class="p">,</span> <span class="n">scenario_index</span><span class="p">):</span>
		<span class="c1"># Get current storage and inflow conditions</span>
        <span class="n">I_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inflow</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">scenario_index</span><span class="p">)</span>
        <span class="n">S_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">volume</span><span class="p">[</span><span class="n">scenario_index</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
        
        <span class="n">I_hat_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardize_inflow</span><span class="p">(</span><span class="n">I_t</span><span class="p">)</span>
        <span class="n">S_hat_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_percent_storage</span><span class="p">(</span><span class="n">S_t</span><span class="p">)</span>
        
        <span class="n">NORhi_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_NORhi</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        <span class="n">NORlo_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_NORlo</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
        
        <span class="n">seasonal_release_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_harmonic_release</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
            
        <span class="c1"># Get adjustment from seasonal release</span>
        <span class="n">epsilon_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_release_adjustment</span><span class="p">(</span><span class="n">S_hat_t</span><span class="p">,</span> 
                                                      <span class="n">I_hat_t</span><span class="p">,</span> 
                                                      <span class="n">NORhi_t</span><span class="p">,</span> <span class="n">NORlo_t</span><span class="p">)</span>
        
        <span class="c1"># Get target release</span>
        <span class="n">target_release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_target_release</span><span class="p">(</span><span class="n">S_hat</span> <span class="o">=</span> <span class="n">S_hat_t</span><span class="p">,</span>
                                                    <span class="n">I</span> <span class="o">=</span> <span class="n">I_t</span><span class="p">,</span>
                                                    <span class="n">NORhi</span><span class="o">=</span><span class="n">NORhi_t</span><span class="p">,</span>
                                                    <span class="n">NORlo</span><span class="o">=</span><span class="n">NORlo_t</span><span class="p">,</span>
                                                    <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon_t</span><span class="p">,</span>
                                                    <span class="n">harmonic_release</span><span class="o">=</span><span class="n">seasonal_release_t</span><span class="p">)</span>
    
        <span class="c1"># Get actual release subject to constraints</span>
        <span class="n">release_t</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">target_release</span><span class="p">,</span> <span class="n">I_t</span> <span class="o">+</span> <span class="n">S_t</span><span class="p">),</span> <span class="p">(</span><span class="n">I_t</span> <span class="o">+</span> <span class="n">S_t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">S_cap</span><span class="p">))</span> 
	    <span class="k">return</span>  <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">release_t</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;node&quot;</span><span class="p">)</span>
        <span class="n">storage_node</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;reservoir_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
        <span class="n">flow_parameter</span> <span class="o">=</span> <span class="n">load_parameter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;flow_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">storage_node</span><span class="p">,</span> <span class="n">flow_parameter</span><span class="p">,</span> <span class="o">**</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Register the parameter for use with Pywr</span>
<span class="n">STARFITReservoirRelease</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>
</pre></div>
</div>
<p>We assign the custom STARFIT parameter to each of the STARFIT reservoir nodes (non-NYC reservoirs) in <code class="docutils literal notranslate"><span class="pre">make_model.add_major_node()</span></code>, like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### For STARFIT reservoirs, use custom parameter</span>
<span class="k">if</span> <span class="n">starfit_release</span><span class="p">:</span>
	<span class="n">model</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;starfit_release_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;STARFITReservoirRelease&#39;</span><span class="p">,</span>
		<span class="s1">&#39;node&#39;</span><span class="p">:</span> <span class="n">name</span>
	<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="ffmp-and-lower-basin-ffmp-parameters">
<h4>2.3.2 FFMP and lower basin FFMP parameters<a class="headerlink" href="#ffmp-and-lower-basin-ffmp-parameters" title="Link to this heading">#</a></h4>
<p>The Flexible Flow Management Program (FFMP) is implemented using a set of custom parameters.  These parameters are too complex to describe here, and would require their own informational guide.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section id="activity-explore-the-parameters-in-pywr-drb">
<h2>Activity: Explore the parameters in Pywr-DRB<a class="headerlink" href="#activity-explore-the-parameters-in-pywr-drb" title="Link to this heading">#</a></h2>
<p>Go back to Pywr-DRB Tutorial 01, and run the code up through section 3.3 Parameters.</p>
<p>You will find this code block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Read model parameter names into a list</span>
<span class="n">model_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">model_parameters</span><span class="p">)</span><span class="si">}</span><span class="s1"> parameters in the model&#39;</span><span class="p">)</span>
<span class="c1"># [output]: There are 394 parameters in the model</span>
</pre></div>
</div>
<p>Now you have a list of 394 Parameter objects which are used in the model.</p>
<p>For this activity, spend some time exploring this list of parameters.</p>
<p>Some questions to answer:</p>
<ol class="arabic simple">
<li><p>How many different types of parameters are in the model?  What types?</p></li>
<li><p>How frequently is each parameter type used?</p></li>
</ol>
<p>As a bonus, you can consider exploring the dependencies between this parameters using NetworkX, using something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="n">param_graph</span> <span class="o">=</span> <span class="n">model_parameters</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">parents</span><span class="o">.</span><span class="n">graph</span>

<span class="c1"># plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">param_graph</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
<p>This code produces a graph, but it is not very informative… can you improve the graph to make it more helpful by doing things such as color coding the elements in the graph according to their type.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./examples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Tutorial%2001%20Introduction%20to%20PywrDRB.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Overview:</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#links">Links:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content">Content:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pywr-parameters">1.0 Pywr parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-parameters">1.1. The role of parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-parameters">1.2 Basic parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#constantparameter">ConstantParameter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregatedparameter">AggregatedParameter</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dataframeparameter">DataFrameParameter</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-parameters">1.3 Custom parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pywr-drb-parameters">2.0 Pywr-DRB parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#a-quick-tangent-pywrdrb-make-model">2.1 A quick tangent: <code class="docutils literal notranslate"><span class="pre">pywrdrb.make_model()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-parameters-in-pywr-drb">2.2 Basic parameters in Pywr-DRB</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-parameters-in-pywr-drb">2.3 Custom parameters in Pywr-DRB</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#starfitreservoirrelease">2.3.1 <code class="docutils literal notranslate"><span class="pre">STARFITReservoirRelease</span></code></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ffmp-and-lower-basin-ffmp-parameters">2.3.2 FFMP and lower basin FFMP parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#activity-explore-the-parameters-in-pywr-drb">Activity: Explore the parameters in Pywr-DRB</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Reed Group at Cornell CEE
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>